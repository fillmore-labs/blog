<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>The Perils of Pointers in the Land of the Zero-Sized Type | Fillmore Labs Blog</title><meta name=description content><meta property="og:url" content="https://blog.fillmore-labs.com/posts/zerosized-1/"><meta property="og:site_name" content="Fillmore Labs Blog"><meta property="og:title" content="The Perils of Pointers in the Land of the Zero-Sized Type"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-31T12:00:00+02:00"><meta property="article:modified_time" content="2025-05-31T12:00:00+02:00"><meta property="article:tag" content="Go"><meta property="og:see_also" content="https://blog.fillmore-labs.com/posts/zerosized-2/"><meta itemprop=name content="The Perils of Pointers in the Land of the Zero-Sized Type"><meta itemprop=datePublished content="2025-05-31T12:00:00+02:00"><meta itemprop=dateModified content="2025-05-31T12:00:00+02:00"><meta itemprop=wordCount content="2161"><meta itemprop=keywords content="Go"><meta name=twitter:card content="summary"><meta name=twitter:title content="The Perils of Pointers in the Land of the Zero-Sized Type"><link rel=preload href=/scss/main.min.513a7829f0df0e3c9a3f1f793b94c67a20ace1b613afe637bc034649fc4dc2ae.css as=style integrity="sha256-UTp4KfDfDjyaPx95O5TGeiCs4bYTr+Y3vANGSfxNwq4=" crossorigin=anonymous><link href=/scss/main.min.513a7829f0df0e3c9a3f1f793b94c67a20ace1b613afe637bc034649fc4dc2ae.css rel=stylesheet integrity="sha256-UTp4KfDfDjyaPx95O5TGeiCs4bYTr+Y3vANGSfxNwq4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Fillmore Labs Blog</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/posts/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/tags/><span>Tags</span></a></li><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/fillmore-labs/ target=_blank rel=noopener><i class='fa-brands fa-github'></i><span>GitHub</span></a></li><li class=nav-item><a class=nav-link href=/><span></span></a></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-posts-li><a href=/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-posts><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postserrors-2-li><a href=/posts/errors-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postserrors-2><span>The Day the Linter Broke My Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postserrors-1-li><a href=/posts/errors-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postserrors-1><span>Understanding Go Error Types: Pointer vs. Value</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postszerosized-2-li><a href=/posts/zerosized-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postszerosized-2><span>A Zero-Sized Bug Hunt in golang.org/x/sync</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-postszerosized-1-li><a href=/posts/zerosized-1/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-postszerosized-1><span class=td-sidebar-nav-active-item>The Perils of Pointers in the Land of the Zero-Sized Type</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsconcurrency-bugs-2-li><a href=/posts/concurrency-bugs-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsconcurrency-bugs-2><span>More Concurrency Bugs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsconcurrency-bugs-1-li><a href=/posts/concurrency-bugs-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsconcurrency-bugs-1><span>Concurrency Bugs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsjavavirtualthreads-2-li><a href=/posts/javavirtualthreads-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsjavavirtualthreads-2><span>Java Structured Concurrency</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsjavavirtualthreads-1-li><a href=/posts/javavirtualthreads-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsjavavirtualthreads-1><span>Java Virtual Threads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsstructured-5-li><a href=/posts/structured-5/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsstructured-5><span>How to Write Concurrent Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsstructured-4-li><a href=/posts/structured-4/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsstructured-4><span>Existing Libraries</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsstructured-3-li><a href=/posts/structured-3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsstructured-3><span>Comparison to Our Original Approach</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsstructured-2-li><a href=/posts/structured-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsstructured-2><span>An Alternative Approach</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsstructured-1-li><a href=/posts/structured-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsstructured-1><span>Structured Concurrency</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsgoroutines-4-li><a href=/posts/goroutines-4/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsgoroutines-4><span>Resource Leaks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsgoroutines-3-li><a href=/posts/goroutines-3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsgoroutines-3><span>Avoiding Unnecessary Work</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsgoroutines-2-li><a href=/posts/goroutines-2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsgoroutines-2><span>Using Goroutines Will Not Grant You Another CPU Core</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsgoroutines-1-li><a href=/posts/goroutines-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsgoroutines-1><span>Goroutines Are Cheap, but Not Free</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#pointergeist-the-zero-dimension>Pointergeist: The Zero Dimension</a><ul><li><a href=#the-great-pointer-escape>The Great Pointer Escape</a></li><li><a href=#honey-i-shrunk-the-alloc>Honey, I Shrunk the Alloc</a></li><li><a href=#by-design-the-equality-paradox>By Design: The Equality Paradox</a></li><li><a href=#the-errorsis-illusion-escaped-zero-sized-types-all-look-the-same>The <code>errors.Is</code> Illusion: Escaped Zero-Sized Types All Look the Same</a></li></ul></li><li><a href=#a-new-linter-of-hope>A New Linter of Hope</a><ul><li><a href=#preventing-pointer-pandemonium>Preventing Pointer Pandemonium</a></li></ul></li><li><a href=#practical-application-the-art-of-embedding>Practical Application: The Art of Embedding</a><ul><li><a href=#value-embedding-saving-private-memory-with-free-methods>Value Embedding: Saving Private Memory (With Free Methods)</a></li><li><a href=#common-pitfall-the-eight-byte-burden--the-nil-panic>Common Pitfall: The Eight-Byte Burden & The Nil Panic</a></li><li><a href=#interface-evolution-grpc-go-case-study>Interface Evolution: gRPC-Go Case Study</a></li></ul></li><li><a href=#the-tao-of-zst-a-guide-to-robust-go>The Tao of ZST: A Guide to Robust Go</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/categories/architecture/ data-taxonomy-term=architecture><span class=taxonomy-label>Architecture</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/categories/concurrency/ data-taxonomy-term=concurrency><span class=taxonomy-label>Concurrency</span><span class=taxonomy-count>13</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/categories/errors/ data-taxonomy-term=errors><span class=taxonomy-label>Errors</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/categories/linter/ data-taxonomy-term=linter><span class=taxonomy-label>Linter</span><span class=taxonomy-count>4</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-series"><h5 class=taxonomy-title>Series</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/series/go-concurrency/ data-taxonomy-term=go-concurrency><span class=taxonomy-label>Go Concurrency</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/series/go-errors/ data-taxonomy-term=go-errors><span class=taxonomy-label>Go Errors</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/series/structured-concurrency/ data-taxonomy-term=structured-concurrency><span class=taxonomy-label>Structured Concurrency</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/series/zero-sized-types/ data-taxonomy-term=zero-sized-types><span class=taxonomy-label>Zero-Sized Types</span><span class=taxonomy-count>2</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/tags/go/ data-taxonomy-term=go><span class=taxonomy-label>Go</span><span class=taxonomy-count>15</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/tags/goroutines/ data-taxonomy-term=goroutines><span class=taxonomy-label>Goroutines</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/tags/java/ data-taxonomy-term=java><span class=taxonomy-label>Java</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/tags/jvm/ data-taxonomy-term=jvm><span class=taxonomy-label>Jvm</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/tags/virtual-threads/ data-taxonomy-term=virtual-threads><span class=taxonomy-label>Virtual-Threads</span><span class=taxonomy-count>2</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/posts/>Blog</a></li><li class="breadcrumb-item active" aria-current=page>The Perils of Pointers in the Land of the Zero-Sized Type</li></ol></nav><div class=td-content><h1>The Perils of Pointers in the Land of the Zero-Sized Type</h1><div class="td-byline mb-4"><time datetime=2025-05-31 class=text-body-secondary>Saturday, May 31, 2025</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/categories/architecture/ data-taxonomy-term=architecture><span class=taxonomy-label>Architecture</span></a></li><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/categories/linter/ data-taxonomy-term=linter><span class=taxonomy-label>Linter</span></a></li></ul></div><div class="taxonomy taxonomy-terms-article taxo-series"><h5 class=taxonomy-title>Series:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/series/zero-sized-types/ data-taxonomy-term=zero-sized-types><span class=taxonomy-label>Zero-Sized Types</span></a></li></ul></div><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.fillmore-labs.com/tags/go/ data-taxonomy-term=go><span class=taxonomy-label>Go</span></a></li></ul></div></header><p>Imagine writing a translation function that transforms internal errors into public API errors. In the first iteration,
you return <code>nil</code> when no translation takes place. You make a simple change — returning the original error instead of
<code>nil</code> — and suddenly your program behaves differently:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>translate1: unsupported operation
</span></span></span><span class=line><span class=cl><span class=go>translate2: internal not implemented
</span></span></span></code></pre></div><p>This program prints two different results from the nearly identical functions
(<a href=https://go.dev/play/p/CP4gFBMqvHL>Go Playground</a>). Can you spot why?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>NotImplementedError</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>NotImplementedError</span><span class=p>)</span><span class=w> </span><span class=nf>Error</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=s>&#34;internal not implemented&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>Translate1</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NotImplementedError</span><span class=p>{})</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>ErrUnsupported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>Translate2</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NotImplementedError</span><span class=p>{})</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>ErrUnsupported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;translate1: %v\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nf>Translate1</span><span class=p>(</span><span class=nf>DoWork</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;translate2: %v\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nf>Translate2</span><span class=p>(</span><span class=nf>DoWork</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>DoWork</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NotImplementedError</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>The key to this divergent behavior lies in <code>NotImplementedError</code> being a zero-sized type (ZST). ZSTs are types that
occupy no memory. Common examples include empty structs <code>struct{}</code> or a zero-length array <code>[0]byte</code>. While highly useful
for tasks like signaling without data transfer (e.g., (<code>chan struct{}</code> in
<a href=https://pkg.go.dev/context#Context.Done><code>Context.Done()</code></a>) or implementing sets (<code>map[string]struct{}</code>), their
interaction with pointers can be particularly tricky.</p><p>So, why does this simple change lead to different outcomes?</p><h2 id=pointergeist-the-zero-dimension>Pointergeist: The Zero Dimension<a class=td-heading-self-link href=#pointergeist-the-zero-dimension aria-label="Heading self-link"></a></h2><p>To understand this behavior, let&rsquo;s see what the Go compiler does behind the scenes.</p><h3 id=the-great-pointer-escape>The Great Pointer Escape<a class=td-heading-self-link href=#the-great-pointer-escape aria-label="Heading self-link"></a></h3><p>When we run <code>go build -gcflags='-m=1' .</code>, we get something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go>./main.go:14:17: err does not escape
</span></span></span><span class=line><span class=cl><span class=go>./main.go:15:13: &amp;NotImplementedError{} does not escape
</span></span></span><span class="line hl"><span class=cl><span class=go>./main.go:22:17: leaking param: err to result ~r0 level=0
</span></span></span><span class=line><span class=cl><span class=go>./main.go:23:13: &amp;NotImplementedError{} does not escape
</span></span></span><span class=line><span class=cl><span class=go>./main.go:31:12: ... argument does not escape
</span></span></span><span class=line><span class=cl><span class=go>./main.go:31:50: &amp;NotImplementedError{} does not escape
</span></span></span><span class=line><span class=cl><span class=go>./main.go:31:43: &amp;NotImplementedError{} does not escape
</span></span></span><span class=line><span class=cl><span class=go>./main.go:32:12: ... argument does not escape
</span></span></span><span class="line hl"><span class=cl><span class=go>./main.go:32:50: &amp;NotImplementedError{} escapes to heap
</span></span></span><span class=line><span class=cl><span class=go>./main.go:32:43: &amp;NotImplementedError{} does not escape
</span></span></span><span class="line hl"><span class=cl><span class=go>./main.go:36:9: &amp;NotImplementedError{} escapes to heap
</span></span></span></code></pre></div><p>The critical line is <code>&amp;NotImplementedError{} escapes to heap</code> - this refers to the pointer created in the call to
<code>DoWork()</code> in line 32. It escapes because the parameter in line 22 is a potential return value (<code>return err</code>), which is
fed into <code>fmt.Errorf</code>.</p><p>Escape analysis determines whether variables can remain on the stack or must be allocated on the heap. When the compiler
can&rsquo;t prove a variable won&rsquo;t outlive its function, it “escapes” to the heap.</p><h3 id=honey-i-shrunk-the-alloc>Honey, I Shrunk the Alloc<a class=td-heading-self-link href=#honey-i-shrunk-the-alloc aria-label="Heading self-link"></a></h3><p>When Go allocates memory for zero-sized types, it applies a clever optimization: the runtime returns a pointer to
<code>runtime.zerobase</code> (see the
<a href="https://cs.opensource.google/go/go/+/refs/tags/go1.24.3:src/runtime/malloc.go;l=1017-1020">mallocgc implementation</a>), a
single static variable shared by all heap-allocated ZSTs, instead of allocating new memory for each instance.</p><p>This means multiple <code>&amp;NotImplementedError{}</code> instances that escape to the heap typically point to the same address.</p><p>On the other hand, the <code>&amp;NotImplementedError{}</code> in the comparison in <code>Translate2</code> does not escape. It gets the address
of a (zero-sized) variable on the stack.</p><p>So in <code>Translate2</code>, the comparison <code>err == &amp;NotImplementedError{}</code> involves two pointers that, due to one being on the
stack and the other pointing to <code>runtime.zerobase</code>, have different memory addresses, thus evaluating to false.</p><h3 id=by-design-the-equality-paradox>By Design: The Equality Paradox<a class=td-heading-self-link href=#by-design-the-equality-paradox aria-label="Heading self-link"></a></h3><p>In <code>Translate1</code>, since the <code>err</code> parameter (which is another instance of <code>&amp;NotImplementedError{}</code>) does not escape
within this function, and the <code>&amp;NotImplementedError{}</code> literal in the comparison also doesn&rsquo;t escape, both are
effectively stack-scoped. For stack-allocated ZSTs, the compiler <em>may</em> optimize by assigning them the same memory
address, but this is not guaranteed. This contributes to the unreliability of direct pointer comparisons for ZSTs, as
the outcome can vary depending on compiler decisions and optimizations.</p><p>This is not a bug — the Go language specification <a href=https://go.dev/ref/spec#Comparison_operators>explicitly states</a> that
the equality of pointers to distinct zero-size variables is unspecified:</p><blockquote><p><em>“pointers to distinct zero-size variables may or may not be equal.”</em></p></blockquote><p>Depending on the path the compiler takes, our program&rsquo;s behavior changes, making our logic unsound. The bug is in the
program above, not the compiler.</p><p>You can easily validate the issue by making the error type non-zero-sized:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>NotImplementedError</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=the-errorsis-illusion-escaped-zero-sized-types-all-look-the-same>The <code>errors.Is</code> Illusion: Escaped Zero-Sized Types All Look the Same<a class=td-heading-self-link href=#the-errorsis-illusion-escaped-zero-sized-types-all-look-the-same aria-label="Heading self-link"></a></h3><p>I can hear you saying <em>“Yes, but you should compare errors with <code>errors.Is</code>.”</em> You absolutely should. The example
becomes a little more complex (<a href=https://go.dev/play/p/0q2cMoDkdE3>Go Playground</a>):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>NotImplementedError</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>NotImplementedError</span><span class=p>)</span><span class=w> </span><span class=nf>Error</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=s>&#34;internal not implemented&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>Translate</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NotImplementedError</span><span class=p>{})</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>ErrUnsupported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;translate1: %v\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nf>Translate</span><span class=p>(</span><span class=nf>DoWork1</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;translate2: %v\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nf>Translate</span><span class=p>(</span><span class=nf>DoWork2</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>DoWork1</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>NotImplementedError</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>DoWork2</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>NotImplementedError</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>_</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=c1>// Makes this a non-zero-sized type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>n</span><span class=p>.</span><span class=nx>NotImplementedError</span><span class=w> </span><span class=c1>// Returns pointer to embedded ZST</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>It&rsquo;s important to understand that internally <a href=https://pkg.go.dev/errors#Is><code>errors.Is</code></a> first attempts a
<a href="https://cs.opensource.google/go/go/+/refs/tags/go1.24.3:src/errors/wrap.go;l=55?q=%22err%20%3D%3D%20target%22">direct pointer comparison</a>
— the same pointer comparison as above when comparing concrete error values:</p><blockquote><p><em>“An error is considered to match a target if it is equal to that target”</em></p></blockquote><p>Arguments passed to functions that are not fully inlinable (like <code>errors.Is</code>), or whose lifetime cannot be determined at
compile time to be confined to the caller&rsquo;s stack, will usually escape to the heap. As mentioned earlier, the Go runtime
frequently optimizes them to point to a single static address.</p><p>This makes <code>errors.Is</code> work more predictably for heap-allocated ZST pointers, but you&rsquo;re still relying on an
implementation detail rather than guaranteed behavior.</p><h2 id=a-new-linter-of-hope>A New Linter of Hope<a class=td-heading-self-link href=#a-new-linter-of-hope aria-label="Heading self-link"></a></h2><p><a href=https://github.com/fillmore-labs/zerolint><code>zerolint</code></a> is a static analysis tool specifically designed to detect
problematic usage patterns involving zero-sized types in Go. For example, it will flag the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>go install fillmore-labs.com/zerolint@latest
</span></span></span><span class=line><span class=cl><span class=go>zerolint .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/path/to/your/project/main.go:10:7: error interface implemented on pointer to zero-sized type &#34;example.com/project.NotImplementedError&#34; (zl:err)
</span></span></span><span class=line><span class=cl><span class=go>/path/to/your/project/main.go:27:6: comparison of pointer to zero-size type &#34;example.com/project.NotImplementedError&#34; with error interface (zl:cme)
</span></span></span><span class=line><span class=cl><span class=go>/path/to/your/project/main.go:35:6: comparison of pointer to zero-size type &#34;example.com/project.NotImplementedError&#34; with error interface (zl:cme)
</span></span></span></code></pre></div><h3 id=preventing-pointer-pandemonium>Preventing Pointer Pandemonium<a class=td-heading-self-link href=#preventing-pointer-pandemonium aria-label="Heading self-link"></a></h3><p>This tool helps avoid the errors discussed by catching potential issues before they lead to runtime bugs, saving
debugging time and preventing unexpected behavior in production.</p><ol><li><p><strong>Identifying Unreliable Comparisons:</strong> The linter flags comparisons of pointers to zero-sized types, such as
<code>errors.Is(err, &amp;NotImplementedError{})</code>. By highlighting these comparisons during development or in CI/CD pipelines,
<code>zerolint</code> prompts developers to reconsider their logic. Instead of relying on pointer equality (which is unspecified
for distinct ZSTs), developers are encouraged to use sentinel errors or reconsider whether a value type is more
appropriate.</p></li><li><p><strong>Discouraging Pointer Receivers for ZSTs:</strong> The linter warns when methods are defined on pointer receivers for
zero-sized types (e.g., <code>func (*NotImplementedError) Error() string</code>). While syntactically valid, using pointer
receivers for ZSTs is often unnecessary and can lead to the kind of pointer-related confusion the article describes.
Value receivers (<code>func (NotImplementedError) Error() string</code>) are usually clearer and avoid any ambiguity about
pointer identity for ZSTs, as comparisons of values of these types (not pointers to them) are straightforward.
<code>zerolint</code> encourages this safer practice.</p></li><li><p><strong>Promoting Idiomatic Go:</strong> By flagging these patterns, <code>zerolint</code> helps enforce idioms that lead to more robust and
maintainable Go code. It steers developers away from relying on implementation details or unspecified behaviors of
the compiler and runtime concerning ZST pointers.</p></li></ol><p>The kinds of bugs arising from ZST pointer comparisons can be subtle and hard to reproduce, as they might depend on
compiler versions or specific build conditions. <code>zerolint</code> catches these potential issues before they lead to runtime
bugs.</p><p>In essence, <code>zerolint</code> helps developers adhere to best practices, such as those discussed next regarding struct
embedding and those summarized in this post&rsquo;s conclusion.</p><h2 id=practical-application-the-art-of-embedding>Practical Application: The Art of Embedding<a class=td-heading-self-link href=#practical-application-the-art-of-embedding aria-label="Heading self-link"></a></h2><p>Let&rsquo;s look at some common scenarios, like struct embedding, where these principles and a tool like <code>zerolint</code> become
particularly relevant.</p><h3 id=value-embedding-saving-private-memory-with-free-methods>Value Embedding: Saving Private Memory (With Free Methods)<a class=td-heading-self-link href=#value-embedding-saving-private-memory-with-free-methods aria-label="Heading self-link"></a></h3><p>Zero-sized <a href=https://go.dev/ref/spec#Type_definitions>defined types</a> can group a set of methods for a default behavior
or interface implementation.</p><p>A method call on a zero-sized receiver has the same runtime behavior as a pure function call, since there&rsquo;s no instance
data to pass on the stack. Passing a ZST as a parameter is essentially free at runtime. This is different for pointer,
though, as we will see below.</p><p>Assuming we want to have a variant of <a href=https://pkg.go.dev/github.com/spf13/afero#OsFs><code>afero.OsFs</code></a> with the <code>Remove</code>
method disabled, we would do:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;errors&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;unsafe&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;github.com/spf13/afero&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>ErrInvalidOperation</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;invalid operation&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>ReadOnlyFS</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>afero</span><span class=p>.</span><span class=nx>OsFs</span><span class=w>  </span><span class=c1>// Embedded value - 0 bytes overhead</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>ReadOnlyFS</span><span class=p>)</span><span class=w> </span><span class=nf>Remove</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nx>ErrInvalidOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>a</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ReadOnlyFS</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nf>Sizeof</span><span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>OsFs</span><span class=p>))</span><span class=w>  </span><span class=c1>// Prints: 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>a</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;test.txt&#34;</span><span class=p>)</span><span class=w>  </span><span class=c1>// Works perfectly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>This prints 0, demonstrating that we get all the methods from <code>afero.OsFs</code> with zero memory overhead.</p><h3 id=common-pitfall-the-eight-byte-burden--the-nil-panic>Common Pitfall: The Eight-Byte Burden & The Nil Panic<a class=td-heading-self-link href=#common-pitfall-the-eight-byte-burden--the-nil-panic aria-label="Heading self-link"></a></h3><p>Now let&rsquo;s see what happens when we use pointers instead:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;errors&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;unsafe&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;github.com/spf13/afero&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>ErrInvalidOperation</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;invalid operation&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>ReadOnlyFS</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>*</span><span class=nx>afero</span><span class=p>.</span><span class=nx>OsFs</span><span class=w>  </span><span class=c1>// Embedded pointer - 8 bytes + nil pointer risk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>ReadOnlyFS</span><span class=p>)</span><span class=w> </span><span class=nf>Remove</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nx>ErrInvalidOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>a</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>ReadOnlyFS</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nf>Sizeof</span><span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>OsFs</span><span class=p>))</span><span class=w>  </span><span class=c1>// Prints: 8 (wasted space)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>a</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;test.txt&#34;</span><span class=p>)</span><span class=w>  </span><span class=c1>// Panics! (nil pointer)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>This approach has two problems:</p><p>First, adding a level of indirection to zero-sized types negates their primary memory benefit. A pointer to a ZST itself
consumes memory (typically 8 bytes on a 64-bit system for the pointer itself), whereas the ZST value consumes zero
bytes. Since the pointer could mostly be the address of <code>runtime.zerobase</code> or <code>nil</code>, we waste 8 bytes for very little
information.</p><p>Second, the embedded pointer <code>OsFs</code> is <code>nil</code> because it&rsquo;s uninitialized. While Go allows calling methods on <code>nil</code>
receivers if the method is defined to handle nil (e.g., by checking if the receiver is nil), in this case,
<code>a.Open("test.txt")</code> attempts to dereference the <code>nil</code> pointer (as <code>Open</code> has a value receiver), causing a runtime
panic.</p><h3 id=interface-evolution-grpc-go-case-study>Interface Evolution: gRPC-Go Case Study<a class=td-heading-self-link href=#interface-evolution-grpc-go-case-study aria-label="Heading self-link"></a></h3><p>ZSTs are excellent for providing default implementations for interfaces, especially when embedded by value. Since an
embedded ZST occupies 0 bytes, it adds no size to the surrounding struct, so there&rsquo;s no overhead.</p><p>A prominent example of this is found in gRPC for Go, specifically in server implementations. To ensure forward
compatibility, <code>UnimplementedXXXServer</code> structs are provided:</p><div class=highlight filename=generated.go><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// UnimplementedXXXServer must be embedded to have</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// forward compatible implementations.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// NOTE: this should be embedded by value instead of pointer to avoid a nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// pointer dereference when methods are called.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>UnimplementedXXXServer</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>UnimplementedXXXServer</span><span class=p>)</span><span class=w> </span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>GetUserRequest</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>GetUserResponse</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>Unimplemented</span><span class=p>,</span><span class=w> </span><span class=s>&#34;method GetUser not implemented&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight filename=implementation.go><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>XXXServer</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>UnimplementedXXXServer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>XXXServer</span><span class=p>)</span><span class=w> </span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>GetUserRequest</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>GetUserResponse</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>For some background see gRPC-Go&rsquo;s <a href=https://github.com/grpc/grpc-go/issues/2318>issue 2318</a> and
<a href=https://github.com/grpc/grpc-go/issues/3669>issue 3669</a>.</p><h2 id=the-tao-of-zst-a-guide-to-robust-go>The Tao of ZST: A Guide to Robust Go<a class=td-heading-self-link href=#the-tao-of-zst-a-guide-to-robust-go aria-label="Heading self-link"></a></h2><p>Zero-sized types (ZSTs) are a Go feature offering memory efficiency and powerful design mechanisms. However, as we&rsquo;ve
seen, their interaction with pointers can lead to subtle, hard-to-diagnose bugs if not handled with care. Relying on
specific compiler or runtime behaviors (like all escaped ZST pointers resolving to <code>runtime.zerobase</code>) for pointer
comparisons is a path to fragile code.</p><p>To harness the benefits of ZSTs while avoiding the pitfalls, keep these core principles in mind:</p><ol><li><p><strong>Embrace Values, Eschew Pointers:</strong> Whenever possible, use ZSTs as direct values (e.g., <code>myZST</code>) rather than
pointers to them (<code>&amp;myZST</code>). This approach completely avoids the ambiguity of ZST pointer comparisons.</p></li><li><p><strong>Value Receivers are Preferred:</strong> Define methods on value receivers (e.g., <code>func (z MyZST) Method()</code>) for ZSTs.
Pointer receivers (e.g., <code>func (z *MyZST) Method()</code>) are rarely necessary for ZSTs and can reintroduce issues with
pointer comparisons.</p></li><li><p><strong>Embed Values, Not Pointers:</strong> When composing structs, embed ZSTs directly (e.g., embed <code>MyZST</code>) to maintain their
zero memory overhead benefit. Embedding pointers to ZSTs (embed <code>*MyZST</code>) negates this by adding pointer overhead and
the risk of nil pointers.</p></li><li><p><strong>Be Mindful of ZSTs When Designing API Contracts:</strong> For example, use functional options instead of pointer-based
configuration for zero-sized option structs.</p></li><li><p><strong>Mind API Boundaries:</strong> The primary legitimate use case for pointers to ZSTs arises when an external API you must
interact with explicitly requires a pointer receiver or argument. In such instances, the choice is driven by
compatibility.</p></li><li><p><strong>Leverage Static Analysis:</strong> You don&rsquo;t have to navigate these nuances alone. Tools like
<a href=https://github.com/fillmore-labs/zerolint><code>zerolint</code></a> are invaluable for automatically flagging problematic ZST
pointer usage in your codebase, guiding you towards safer and more idiomatic Go practices.</p></li></ol><p>The key insight is that zero-sized types are powerful as values but risky and wasteful as pointers. Understanding this
distinction will save you from subtle, hard-to-debug issues that can vary between compiler versions and build
conditions.</p><p>&mldr; continued in the <a href=/posts/zerosized-2>next post</a>.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/posts/concurrency-bugs-2/ aria-label="Previous - More Concurrency Bugs" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a href=/posts/zerosized-2/ aria-label="Next - A Zero-Sized Bug Hunt in golang.org/x/sync" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"></div></div></div></footer></div><script src=/js/main.min.f71407511ada5a21bfee79c04b8036785595c1126c9c29126bc3d4ecee5f2f85.js integrity="sha256-9xQHURraWiG/7nnAS4A2eFWVwRJsnCkSa8PU7O5fL4U=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>